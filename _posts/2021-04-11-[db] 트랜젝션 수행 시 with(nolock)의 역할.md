---
layout: post
title:  "[db] 트랜잭션 수행 시 with(nolock)의 역할"
date:   2021-04-05T14:25:52-05:00
tags: db 락 lock 트랜잭션 쿼리
categories: For-You
---

### 독립성과 원자성
데이터베이스는 트랜잭션 수행 시 기본적으로 `ACID` 중, A (원자성)과 I (독립성)을 보장한다.
> 트랜잭션: 데이터베이스의 상태를 변화시키기 해서 수행하는 작업의 단위 (select, insert, delete, update)
> 원자성: 트랜잭션과 관련된 일은 모두 실행되던지 모두 실행되지 않도록 하던지를 보장하는 특성
> 독립성: 트랜잭션을 수행하는 도중에 다른 연산작업이 끼어들지 못하도록 보장하는 특성

### with(nolock)
트랜잭션 수행 시 데이터 테이블의 끝단에 `with(nolock)`을 필수록 적어주어야 한다고 배웠다.
이 두 단어가 어떤 역학을 할까?

`Locking`이란 트랜잭션이 특정 데이터 테이블에 작업을 하고 있을 때, 다른 트랜잭션이 관여하지 못하도록 하는 것이다.
원자성과 독립성을 보장하는 역할을 하게 되는데 그렇다면 오히려 lock을 걸어야하는 것 아닌가? 생각할 수도 있다.
그러나 무조건적인 locking은 동시에 요청된 다수의 트랜잭션들을 순서대로 처리할 시에 병목현상, 데드락이 발생할 수 있고 DB의 성능은 급격하게 떨어진다. 
상황에 맞는 locking으로 트랜잭션의 효율을 높이는 것이 당연하다지만, 분석가 수준에서의 트랜잭션은 대부분 `with(nolock)`을 적어주는 것이 좋다고 한다.
